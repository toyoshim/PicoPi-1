// Copyright 2022 Takashi Toyoshima <toyoshim@gmail.com>.
// Use of this source code is governed by a BSD-style license that can be found
// in the LICENSE file.
use crate::Rim;

pub struct RimSnowflake {
    offset: u16,
    rom: [u32; 585],
}

impl Rim for RimSnowflake {
    fn next(&mut self) -> u32 {
        let value = self.rom[self.offset as usize];
        self.offset += 1;
        return value;
    }
}

// Following ROM dump is a copy of the original PDP-1 Snowflake
// https://www.computerhistory.org/pdp-1/302b0352d9c7f251168d635bfdab65b4/
// PDP-1 emulation core may have a bug as this doesn't seem working correctly.
static ROM: [u32; 585] = [
    0x01afe9, 0x03b002, 0x01afea, 0x01aff0, 0x01afeb, 0x008ff0, 0x01afec, 0x01affe, 0x01afed,
    0x03b002, 0x01afee, 0x01afff, 0x01afef, 0x03b002, 0x01aff0, 0x030040, 0x01aff1, 0x011ff0,
    0x01aff2, 0x020ffe, 0x01aff3, 0x014ffe, 0x01aff4, 0x024ff0, 0x01aff5, 0x02afff, 0x01aff6,
    0x030fef, 0x01aff7, 0x010ffe, 0x01aff8, 0x020fff, 0x01aff9, 0x03b002, 0x01affa, 0x01affe,
    0x01affb, 0x02affe, 0x01affc, 0x03e100, 0x01affd, 0x030fe9, 0x030fe9, 0x01a000, 0x01a040,
    0x007e4f, 0x020b63, 0x008d45, 0x030b65, 0x010000, 0x012001, 0x03a107, 0x024012, 0x02a013,
    0x030007, 0x01c012, 0x01c012, 0x024014, 0x03a05b, 0x034400, 0x030004, 0x03e100, 0x030002,
    0x000000, 0x000001, 0x011b26, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x02a49b, 0x01a040, 0x01a080, 0x01010b, 0x01410c, 0x010511, 0x014512, 0x00f073,
    0x01510c, 0x01b512, 0x02410c, 0x024512, 0x02a50f, 0x030044, 0x010102, 0x014103, 0x01110c,
    0x014100, 0x011512, 0x014101, 0x01010c, 0x022104, 0x01410c, 0x010512, 0x022104, 0x014512,
    0x028511, 0x03005d, 0x00f091, 0x01510c, 0x01b512, 0x030051, 0x01110c, 0x014100, 0x011512,
    0x014101, 0x02410c, 0x024512, 0x028510, 0x030069, 0x00f091, 0x01510c, 0x01b512, 0x030061,
    0x026103, 0x030085, 0x00f073, 0x01510b, 0x01b511, 0x00f073, 0x01510a, 0x01b510, 0x030081,
    0x000082, 0x00e712, 0x016072, 0x010105, 0x02c107, 0x037401, 0x01a105, 0x010106, 0x02c107,
    0x037401, 0x01a106, 0x020105, 0x014105, 0x03660f, 0x02bc1e, 0x01a080, 0x01a0c0, 0x031072,
    0x00f073, 0x0150fe, 0x01b0ff, 0x03008a, 0x010105, 0x0150fe, 0x010106, 0x0150ff, 0x03004d,
    0x00208e, 0x03e200, 0x014103, 0x03004d, 0x00003c, 0x000000, 0x000066, 0x000548, 0x016090,
    0x034200, 0x03e080, 0x011512, 0x020101, 0x034200, 0x03009b, 0x037a01, 0x03009e, 0x006108,
    0x037a01, 0x006109, 0x014101, 0x01110c, 0x020100, 0x034200, 0x0300a5, 0x037a01, 0x0300a8,
    0x006108, 0x037a01, 0x006109, 0x014100, 0x030145, 0x03ae07, 0x034008, 0x031090, 0x03b000,
    0x03e200, 0x03b607, 0x0367ff, 0x0367ff, 0x03b607, 0x03e200, 0x03b607, 0x0367ff, 0x0367ff,
    0x03b607, 0x03e200, 0x03b607, 0x0367ff, 0x0367ff, 0x03b607, 0x010101, 0x012100, 0x03b607,
    0x0134dc, 0x01a0c0, 0x01a100, 0x010100, 0x012101, 0x031090, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x00208e,
    0x035040, 0x030040, 0x03008b, 0x03008b, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
    0x000000, 0x000000, 0x000120, 0x00052e, 0x00ecc8, 0x01a100, 0x01a140, 0x00b980, 0x0026c1,
    0x03ffdf, 0x03ffe1, 0x000001, 0x02a033, 0x01d1dd, 0x01c5a3, 0x01ffff, 0x02ffff, 0x000144,
    0x00010d, 0x000142, 0x01cb84, 0x01af8b, 0x01937d, 0x017744, 0x015ac7, 0x013de9, 0x012088,
    0x010280, 0x00e3a8, 0x00c3d7, 0x00a2e4, 0x0080a7, 0x005cfe, 0x0037ce, 0x001107, 0x03e8a1,
    0x03bea3, 0x039320, 0x036637, 0x033815, 0x0355e3, 0x037262, 0x038d52, 0x03a67e, 0x03bdbc,
    0x03d2f1, 0x03e60f, 0x03f713, 0x000608, 0x001301, 0x001e1b, 0x00277c, 0x002f4e, 0x0035c1,
    0x003b08, 0x003f59, 0x0042ea, 0x0045f3, 0x0048aa, 0x004b45, 0x004dfa, 0x0050fa, 0x005475,
    0x005896, 0x005d85, 0x006362, 0x006a49, 0x00724c, 0x007b77, 0x0085cb, 0x009140, 0x00296f,
    0x01a140, 0x01a180, 0x009dc4, 0x00ab3b, 0x00c7c5, 0x00d74e, 0x00e712, 0x012101, 0x034010,
    0x0300aa, 0x01417a, 0x01a179, 0x037a01, 0x014173, 0x010179, 0x037a01, 0x014176, 0x01017a,
    0x02c178, 0x014177, 0x010179, 0x02c178, 0x014172, 0x010177, 0x022176, 0x014171, 0x03e200,
    0x014170, 0x010177, 0x020176, 0x014175, 0x03e200, 0x014174, 0x010172, 0x022173, 0x012175,
    0x030184, 0x012174, 0x03b0c7, 0x010173, 0x020172, 0x03018d, 0x012171, 0x03b0c7, 0x012170,
    0x03b0c7, 0x03017b, 0x03e200, 0x0367ff, 0x0367ff, 0x0372ba, 0x008d45, 0x00218f, 0x005cc0,
    0x034bfa, 0x00b405, 0x001360, 0x00a0a5, 0x01bb66, 0x0026c1, 0x00b980, 0x010179, 0x03e200,
    0x0367ff, 0x0367ff, 0x01017a, 0x02bee1, 0x01a180, 0x01a1a2, 0x03b0c7, 0x03e200, 0x03b0c7,
    0x012179, 0x03b0c7, 0x03e200, 0x03b0c7, 0x03e200, 0x012174, 0x03b0c7, 0x03e200, 0x03b0c7,
    0x030165, 0x012171, 0x03b0c7, 0x03e200, 0x03b0c7, 0x012170, 0x03b0c7, 0x03e200, 0x03b0c7,
    0x010179, 0x03e200, 0x0367ff, 0x0367ff, 0x01017a, 0x03b0c7, 0x03e200, 0x03b0c7, 0x012179,
    0x03b0c7, 0x03e200, 0x03b0c7, 0x0300c0, 0x025c7c, 0x01a50f, 0x01a540, 0x00054b, 0x00054a,
    0x000513, 0x000548, 0x00575f, 0x004ab6, 0x003e5e, 0x0032a6, 0x0027d9, 0x001e3d, 0x001611,
    0x000f8c, 0x000add, 0x00082b, 0x000796, 0x000936, 0x000d1d, 0x001357, 0x001bec, 0x0026df,
    0x00342f, 0x0043da, 0x0055d7, 0x006a1c, 0x00809a, 0x00993c, 0x00b3e9, 0x00d081, 0x00eedf,
    0x010ed5, 0x013030, 0x0152b5, 0x0135a7, 0x0119b9, 0x00ff1a, 0x00e5f3, 0x00ce63, 0x00b882,
    0x00a45e, 0x0091ff, 0x008163, 0x007282, 0x006550, 0x0059b9, 0x004fa8, 0x004703, 0x003faf,
    0x00398f, 0x003486, 0x03a504, 0x01a540, 0x01a54b, 0x003077, 0x002d45, 0x002ad4, 0x00290b,
    0x0027d0, 0x00270c, 0x0026aa, 0x002697, 0x0026eb, 0x00276e, 0x0027ff, 0x010e9c, 0x01aa00,
    0x01aa1d, 0x00609d, 0x02a529, 0x01f410, 0x017c00, 0x000000, 0x000000, 0x024118, 0x030000,
    0x000000, 0x000000, 0x000000, 0x000000, 0x000278, 0x00f880, 0x000000, 0x000000, 0x020000,
    0x011800, 0x004508, 0x031802, 0x009531, 0x012508, 0x007108, 0x010846, 0x035ad6, 0x00e800,
    0x0294a5, 0x00a800, 0x0064a5, 0x0192bc, 0x030040, 0x02487f, 0x038fbe, 0x03f000, 0x000000,
];

impl RimSnowflake {
    pub fn new() -> Self {
        RimSnowflake {
            offset: 0,
            rom: ROM,
        }
    }
}
